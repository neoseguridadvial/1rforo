<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda 1er Foro Nacional - ANSV</title>
    
    <!-- Tailwind CSS (Estilos) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configuraci√≥n de Animaciones Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    keyframes: {
                        'fade-in-up': {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        'pulse-slow': {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.5' },
                        },
                        'glow': {
                            '0%, 100%': { boxShadow: '0 0 15px rgba(249, 115, 22, 0.5), 0 0 30px rgba(249, 115, 22, 0.3)' },
                            '50%': { boxShadow: '0 0 25px rgba(249, 115, 22, 0.8), 0 0 50px rgba(249, 115, 22, 0.5)' },
                        }
                    },
                    animation: {
                        'fade-in-up': 'fade-in-up 0.5s ease-out',
                        'pulse-slow': 'pulse-slow 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'glow': 'glow 2s infinite',
                    }
                }
            }
        }
    </script>

    <!-- Babel (Traductor de React para el navegador) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Estilos para efectos 3D de las tarjetas -->
    <style>
        html { scroll-behavior: smooth; }
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        
        /* USAMOS !important PARA FORZAR EL GIRO SOBRE TAILWIND */
        .rotate-y-180 { transform: rotateY(180deg) !important; }
        .preserve-3d { transform-style: preserve-3d; }
        
        /* Ocultar scrollbar en galer√≠a de fotos */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Estilo personalizado para el reproductor de audio */
        audio {
            height: 32px;
            width: 100%;
            border-radius: 8px;
        }
        audio::-webkit-media-controls-panel {
            background-color: #f1f5f9;
        }
        
        /* Animaci√≥n de onda para dictado */
        .dictating-wave {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #ef4444;
            animation: wave 1.2s linear infinite;
            margin-left: 2px;
        }
        .dictating-wave:nth-child(2) { animation-delay: -1.1s; }
        .dictating-wave:nth-child(3) { animation-delay: -1.0s; }
        
        @keyframes wave {
            0%, 60%, 100% { transform: initial; }
            30% { transform: translateY(-5px); }
        }
    </style>
</head>
<body class="bg-slate-100" id="top">
    
    <div id="root"></div>

    <!-- Tu Aplicaci√≥n React -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        
        // Importamos Lucide Icons
        import { 
          Clock, User, RotateCcw, Pencil, Download, MapPin, Calendar, Mic, Users, 
          Coffee, Award, MessageSquare, CheckCircle, Star, Layout, Heart, Camera, 
          Trash2, PlusCircle, Briefcase, Phone, Save, Info, AlertTriangle, Link, ExternalLink,
          Radio, ArrowUp, Target, MonitorPlay, Zap, Square, Play, Volume2, MicOff, FileCode
        } from 'https://esm.sh/lucide-react@0.263.1';

        // --- DATA SOURCE ---
        const mainAgendaData = [
          { id: 'm0', time: '07:30 - 08:00', duration: '30 min', title: 'Registro y Acreditaci√≥n', moderator: 'Equipo log√≠stico REDIPI', description: 'Registro de participantes presenciales y entrega de escarapelas con QR.', icon: 'check' },
          { id: 'm1', time: '08:00 - 08:10', duration: '10 min', title: 'Instalaci√≥n Oficial', moderator: 'Representante ANSV / Maestro de ceremonias', description: 'Acto protocolario, himnos y palabras de apertura.', icon: 'mic' },
          { id: 'm2', time: '08:10 - 08:50', duration: '40 min', title: 'Innovaci√≥n, Tecnolog√≠a y Liderazgo Empresarial', moderator: 'Daniel Villaveces', description: 'Veh√≠culos seguros, infraestructura inteligente y liderazgo en gesti√≥n.', icon: 'lightbulb' },
          { id: 'm3', time: '08:50 - 09:40', duration: '50 min', title: 'Socializaci√≥n Iniciativas (Bloque 1)', moderator: 'L√≠deres/as Ponentes', description: 'Presentaci√≥n de proyectos ganadores (5 presentaciones).', icon: 'users' },
          { id: 'm4', time: '09:40 - 10:00', duration: '20 min', title: 'Pausa Activa y Networking', moderator: 'Equipo log√≠stico', description: 'Disparador de conversaci√≥n: logros y desaf√≠os.', icon: 'coffee' },
          { id: 'm5', time: '10:00 - 10:40', duration: '40 min', title: 'Liderazgo Comunitario y Cultural', moderator: 'Sandra Milena Tapias', description: 'Liderazgo de la sociedad civil, v√≠ctimas y transformaci√≥n cultural.', icon: 'heart' },
          { id: 'm6', time: '10:40 - 11:30', duration: '50 min', title: 'Socializaci√≥n Iniciativas (Bloque 2)', moderator: 'L√≠deres/as Ponentes', description: 'Continuaci√≥n de presentaci√≥n de proyectos ganadores.', icon: 'users' },
          { id: 'm7', time: '11:30 - 12:10', duration: '50 min', title: 'Taller: Fortalecimiento de la Red', moderator: 'Facilitador/a REDIPI', description: 'Din√°mica "Conectemos nuestros liderazgos" y compromisos de Red.', icon: 'puzzle' },
          { id: 'm8', time: '12:10 - 13:40', duration: '90 min', title: 'Almuerzo Libre', moderator: '-', description: 'Tiempo libre para alimentaci√≥n.', icon: 'coffee' },
          { id: 'm9', time: '13:40 - 14:20', duration: '40 min', title: 'Liderazgo Gubernamental y Gobernanza', moderator: 'Aida Luz Ospina', description: 'Estrategia Nacional y coordinaci√≥n intersectorial.', icon: 'building' },
          { id: 'm10', time: '14:20 - 14:40', duration: '20 min', title: 'Pausa Caf√© y Networking Libre', moderator: 'Equipo log√≠stico', description: 'Espacio distendido para interacci√≥n espont√°nea.', icon: 'coffee' },
          { id: 'm11', time: '14:40 - 15:40', duration: '60 min', title: 'Panel: Liderazgos Transformadores', moderator: 'Rep. ANSV (Modera) / 3 Expertos', description: 'Conversatorio sobre cualidades del l√≠der y experiencias de √©xito.', icon: 'mic' },
          { id: 'm12', time: '15:40 - 16:15', duration: '35 min', title: 'Socializaci√≥n Iniciativas (Bloque 3)', moderator: 'L√≠deres/as Ponentes', description: 'Proyectos con reconocimiento especial.', icon: 'star' },
          { id: 'm13', time: '16:15 - 16:45', duration: '30 min', title: 'Entrega de Certificados', moderator: 'Rep. ANSV / Maestro de ceremonias', description: 'Reconocimiento al Top 10 y entrega de certificados.', icon: 'award' },
          { id: 'm14', time: '16:45 - 17:00', duration: '15 min', title: 'Cierre del Evento', moderator: 'Rep. ANSV / Facilitador REDIPI', description: 'Conclusiones y resultados del proceso formativo.', icon: 'flag' }
        ];

        const womenAgendaData = [
          { id: 'w1', time: '10:00 - 10:05', duration: '5 min', title: 'Bienvenida Encuentro Mujeres', moderator: 'Facilitadora REDIPI', description: 'Apertura guiada y conexi√≥n a sala digital.', icon: 'heart' },
          { id: 'w2', time: '10:05 - 10:25', duration: '20 min', title: 'Mapa Digital: Modos de Movilidad', moderator: 'Facilitadora REDIPI', description: 'Cartograf√≠a colaborativa sobre cargas del cuidado y rutas poligonales.', icon: 'map' },
          { id: 'w3', time: '10:25 - 10:40', duration: '15 min', title: 'Identificaci√≥n de Barreras Invisibles', moderator: 'Facilitadora REDIPI', description: 'An√°lisis de riesgos y cifras ANSV con enfoque de g√©nero.', icon: 'alert' },
          { id: 'w4', time: '10:40 - 10:55', duration: '15 min', title: 'Testimonios: Rutas que Inspiran', moderator: 'Lideresas invitadas', description: 'Narrativa testimonial y escucha activa.', icon: 'message' },
          { id: 'w5', time: '10:55 - 11:15', duration: '20 min', title: 'Co-creaci√≥n: Territorio que Cuida', moderator: 'Facilitadora + Grupos', description: 'Dise√±o participativo de soluciones.', icon: 'users' },
          { id: 'w6', time: '11:15 - 11:20', duration: '5 min', title: 'Cierre Sonoro: Voces que Dejan Eco', moderator: 'Facilitadora REDIPI', description: 'Microtestimonios sonoros con IA.', icon: 'mic' },
          { id: 'w7', time: '11:20 - 11:30', duration: '10 min', title: 'Cierre y Retorno a Plenaria', moderator: 'Facilitadora REDIPI', description: 'Transici√≥n al auditorio principal.', icon: 'rotate' }
        ];

        // --- HELPER FUNCTIONS ---
        const parseTime = (timeStr) => {
            if (!timeStr) return 0;
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        };

        const getCurrentEventStatus = (agendaData, currentMinutes) => {
            let current = null;
            let next = null;
            const sortedData = [...agendaData].sort((a, b) => parseTime(a.time.split(' - ')[0]) - parseTime(b.time.split(' - ')[0]));

            for (let i = 0; i < sortedData.length; i++) {
                const item = sortedData[i];
                const times = item.time.split(' - ');
                const start = parseTime(times[0]);
                const end = parseTime(times[1]);

                if (currentMinutes >= start && currentMinutes < end) {
                    current = item;
                    next = sortedData[i + 1] || null;
                    break; 
                }
                if (currentMinutes < start) {
                    if (!next) next = item;
                    break;
                }
            }
            return { current, next };
        };

        // --- COMPONENTS ---

        // 1. Bot√≥n Volver al Inicio
        const ScrollToTopButton = () => {
            const [visible, setVisible] = useState(false);

            useEffect(() => {
                const toggleVisibility = () => {
                    if (window.pageYOffset > 300) {
                        setVisible(true);
                    } else {
                        setVisible(false);
                    }
                };
                window.addEventListener("scroll", toggleVisibility);
                return () => window.removeEventListener("scroll", toggleVisibility);
            }, []);

            const scrollToTop = () => {
                window.scrollTo({ top: 0, behavior: "smooth" });
            };

            return (
                <button 
                    onClick={scrollToTop}
                    className={`fixed bottom-8 left-8 z-50 bg-white text-orange-600 p-4 rounded-full shadow-2xl border border-orange-200 transition-all duration-300 transform hover:scale-110 hover:bg-orange-50 ${visible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-10 pointer-events-none'}`}
                    title="Volver al inicio"
                >
                    <ArrowUp className="w-6 h-6" />
                </button>
            );
        };

        // 2. Ficha del Evento
        const EventSummaryCard = () => {
            return (
                <div className="max-w-6xl mx-auto px-4 relative z-20 -mt-12">
                    <div className="bg-white rounded-2xl shadow-xl p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 border border-slate-100">
                        <div className="flex items-start space-x-3">
                            <div className="bg-orange-100 p-3 rounded-xl text-orange-600"><Calendar className="w-6 h-6" /></div>
                            <div><h4 className="text-sm font-bold text-slate-400 uppercase tracking-wider">Fecha</h4><p className="font-bold text-slate-800">24 Nov, 2025</p></div>
                        </div>
                        <div className="flex items-start space-x-3">
                            <div className="bg-blue-100 p-3 rounded-xl text-blue-600"><MapPin className="w-6 h-6" /></div>
                            <div><h4 className="text-sm font-bold text-slate-400 uppercase tracking-wider">Lugar</h4><p className="font-bold text-slate-800 text-sm leading-tight">Auditorio Edificio Elemento, Bogot√°</p></div>
                        </div>
                        <div className="flex items-start space-x-3">
                            <div className="bg-green-100 p-3 rounded-xl text-green-600"><Target className="w-6 h-6" /></div>
                            <div>
                                <h4 className="text-sm font-bold text-slate-400 uppercase tracking-wider">Prop√≥sito</h4>
                                <p className="font-bold text-slate-800 text-sm leading-tight line-clamp-2">Reconocimiento y Consolidaci√≥n de la Red</p>
                            </div>
                        </div>
                        <div className="flex items-start space-x-3">
                            <div className="bg-red-100 p-3 rounded-xl text-red-600"><MonitorPlay className="w-6 h-6" /></div>
                            <div><h4 className="text-sm font-bold text-slate-400 uppercase tracking-wider">Transmisi√≥n</h4><p className="font-bold text-slate-800 text-sm">YouTube ANSV / Google Meet</p></div>
                        </div>
                    </div>
                </div>
            );
        };

        // 3. Live Ticker
        const LiveTicker = ({ currentStatus }) => {
            const [time, setTime] = useState(new Date());

            useEffect(() => {
                const timer = setInterval(() => setTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            const formatTime = (date) => date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            return (
                <div className="sticky top-0 z-40 bg-slate-900 text-white shadow-xl border-b-4 border-orange-500 transition-all duration-300">
                    <div className="max-w-6xl mx-auto px-4 py-3 flex flex-col sm:flex-row items-center justify-between gap-4">
                        <div className="flex items-center bg-slate-800 px-4 py-2 rounded-lg shadow-inner border border-slate-700">
                            <Clock className="w-5 h-5 text-orange-400 mr-2 animate-pulse" />
                            <span className="text-xl font-mono font-bold tracking-wider">{formatTime(time)}</span>
                        </div>
                        <div className="flex-1 w-full sm:w-auto text-center sm:text-left flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-6">
                            {currentStatus.current ? (
                                <div className="flex items-center text-orange-100 animate-fade-in-up">
                                    <span className="flex h-3 w-3 relative mr-2">
                                      <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                                      <span className="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>
                                    </span>
                                    <span className="text-xs uppercase font-bold text-red-400 mr-2">En curso:</span>
                                    <span className="font-semibold truncate max-w-[200px] md:max-w-xs" title={currentStatus.current.title}>{currentStatus.current.title}</span>
                                </div>
                            ) : (
                                <div className="text-slate-400 text-sm italic">No hay actividad en curso ahora</div>
                            )}
                            {currentStatus.next && (
                                <div className="flex items-center text-slate-300 text-sm hidden md:flex animate-fade-in-up delay-100">
                                    <span className="text-orange-400 font-bold mr-2 text-xs uppercase">Siguiente:</span>
                                    <span className="truncate max-w-[150px] opacity-80" title={currentStatus.next.title}>{currentStatus.next.time.split(' - ')[0]} - {currentStatus.next.title}</span>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const StatusBadge = ({ status, onClick, type }) => {
          const isActive = status === type;
          let baseClasses = "p-2 rounded-full transition-all duration-300 flex items-center justify-center transform hover:scale-110 z-50 relative";
          let activeClasses = "";
          let IconComp = null;

          if (type === 'interested') {
            activeClasses = isActive ? "bg-yellow-100 text-yellow-500 shadow-inner" : "text-slate-300 hover:text-yellow-400";
            IconComp = Star;
          } else if (type === 'completed') {
            activeClasses = isActive ? "bg-green-100 text-green-600 shadow-inner" : "text-slate-300 hover:text-green-500";
            IconComp = CheckCircle;
          }
          return (
            <button onClick={(e) => { e.stopPropagation(); onClick(type); }} className={`${baseClasses} ${activeClasses}`} title={type === 'interested' ? "Me interesa" : "Ya lo vi / Asist√≠"}>
              <IconComp className={`w-5 h-5 ${isActive ? "fill-current" : ""}`} />
            </button>
          );
        };

        // CARD COMPONENT
        const FlipCard = ({ 
            item, 
            note, 
            onNoteChange, 
            isFlipped, 
            onFlip, 
            status, 
            onStatusChange, 
            photos = [], 
            onPhotoAdd, 
            onPhotoRemove, 
            audios = [], 
            onAudioAdd, 
            onAudioRemove, 
            colorTheme = "orange", 
            isCurrent 
        }) => {
          const isCompleted = status === 'completed';
          const fileInputRef = useRef(null);
          
          const [isRecording, setIsRecording] = useState(false);
          const mediaRecorderRef = useRef(null);
          const audioChunksRef = useRef([]);
          const [isDictating, setIsDictating] = useState(false);
          const recognitionRef = useRef(null);

          const handleCameraClick = () => fileInputRef.current.click();
          const handleFileChange = (e) => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onloadend = () => onPhotoAdd(item.id, reader.result);
              reader.readAsDataURL(file);
              e.target.value = '';
            }
          };

          const startRecording = async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorderRef.current = new MediaRecorder(stream);
                audioChunksRef.current = [];

                mediaRecorderRef.current.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        audioChunksRef.current.push(event.data);
                    }
                };

                mediaRecorderRef.current.onstop = () => {
                    const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/webm' });
                    
                    // Convertir a Base64 inmediatamente para almacenamiento persistente
                    const reader = new FileReader();
                    reader.readAsDataURL(audioBlob);
                    reader.onloadend = () => {
                        const base64Audio = reader.result;
                        onAudioAdd(item.id, base64Audio);
                    };
                    
                    stream.getTracks().forEach(track => track.stop());
                };

                mediaRecorderRef.current.start();
                setIsRecording(true);
            } catch (err) {
                console.error("Error al acceder al micr√≥fono:", err);
                alert("No se pudo acceder al micr√≥fono. Verifica los permisos.");
            }
          };

          const stopRecording = () => {
            if (mediaRecorderRef.current && isRecording) {
                mediaRecorderRef.current.stop();
                setIsRecording(false);
            }
          };

          const toggleRecording = (e) => {
              e.stopPropagation(); 
              if (isRecording) stopRecording();
              else startRecording();
          };

          const toggleDictation = () => {
              if (!('webkitSpeechRecognition' in window)) {
                  alert("Tu navegador no soporta dictado por voz. Intenta usar Google Chrome.");
                  return;
              }

              if (isDictating) {
                  if (recognitionRef.current) {
                      recognitionRef.current.stop();
                  }
                  setIsDictating(false);
              } else {
                  const recognition = new window.webkitSpeechRecognition();
                  recognition.lang = 'es-ES';
                  recognition.interimResults = false;
                  recognition.maxAlternatives = 1;
                  
                  recognitionRef.current = recognition;

                  recognition.onstart = () => {
                      setIsDictating(true);
                  };

                  recognition.onresult = (event) => {
                      const transcript = event.results[0][0].transcript;
                      const currentText = note || "";
                      const newText = currentText + (currentText.length > 0 ? " " : "") + transcript;
                      onNoteChange(item.id, newText);
                  };

                  recognition.onerror = (event) => {
                      if (event.error !== 'no-speech') {
                          console.error("Error en dictado", event.error);
                      }
                      setIsDictating(false);
                  };

                  recognition.onend = () => {
                      setIsDictating(false);
                  };

                  recognition.start();
              }
          };

          const themeClasses = colorTheme === 'purple' 
            ? { bg: 'bg-purple-50', border: 'border-purple-100', text: 'text-purple-700', btn: 'bg-purple-600 hover:bg-purple-700', badge: 'bg-purple-100 text-purple-800' }
            : { bg: 'bg-orange-50', border: 'border-orange-100', text: 'text-orange-700', btn: 'bg-orange-500 hover:bg-orange-600', badge: 'bg-orange-100 text-orange-800' };

          const activeCardClass = isCurrent ? 'ring-4 ring-orange-400 ring-opacity-50 animate-glow border-orange-500 shadow-2xl scale-[1.02]' : '';

          return (
            <div className={`relative w-full h-[34rem] perspective-1000 group transition-transform duration-500 ${isCurrent ? 'z-10' : 'z-0'}`}>
              <div className={`relative w-full h-full transition-all duration-700 preserve-3d ${isFlipped ? 'rotate-y-180' : ''}`}>
                
                {/* FRONT */}
                <div className={`absolute w-full h-full backface-hidden bg-white rounded-2xl shadow-lg border-2 p-6 flex flex-col justify-between ${isCompleted ? 'border-slate-200 opacity-80' : themeClasses.border} ${activeCardClass}`}>
                  
                  {isCurrent && (
                      <div className="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-red-600 text-white text-[10px] font-bold px-3 py-1 rounded-full shadow-md flex items-center animate-bounce z-20">
                          <span className="w-2 h-2 bg-white rounded-full mr-1 animate-pulse"></span>
                          EN CURSO
                      </div>
                  )}

                  <div>
                    <div className="flex justify-between items-start mb-4">
                      <div className={`px-3 py-1 rounded-full text-xs font-bold ${isCompleted ? 'bg-slate-100 text-slate-500' : themeClasses.badge}`}>{item.duration}</div>
                      <div className="flex space-x-1">
                         <StatusBadge status={status} type="interested" onClick={(type) => onStatusChange(item.id, status === type ? null : type)} />
                         <StatusBadge status={status} type="completed" onClick={(type) => onStatusChange(item.id, status === type ? null : type)} />
                      </div>
                    </div>
                    <h3 className={`text-lg font-bold mb-2 leading-tight ${isCompleted ? 'text-slate-400 line-through decoration-2' : 'text-slate-800'}`}>{item.title}</h3>
                    <div className={`flex items-center text-sm mb-2 ${isCompleted ? 'text-slate-300' : 'text-slate-500'}`}><Clock className="w-4 h-4 mr-2" />{item.time}</div>
                    <div className={`flex items-center text-sm ${isCompleted ? 'text-slate-300' : 'text-slate-500'}`}><User className="w-4 h-4 mr-2" /><span className="truncate font-medium">{item.moderator}</span></div>
                  </div>
                  <div className="mt-4 flex items-center justify-between gap-2">
                     <div className="flex items-center gap-1 flex-1 overflow-hidden">
                        <div className="flex flex-col">
                            {photos.length > 0 && (
                                <div className="text-xs text-green-600 flex items-center font-medium"><Camera className="w-3 h-3 mr-1" />{photos.length} foto(s)</div>
                            )}
                            {audios.length > 0 && (
                                <div className="text-xs text-blue-600 flex items-center font-medium"><Mic className="w-3 h-3 mr-1" />{audios.length} audio(s)</div>
                            )}
                            {photos.length === 0 && audios.length === 0 && (
                                <div className="text-xs text-slate-400 italic truncate">{isCompleted ? "Finalizada" : status === 'interested' ? "¬°Te interesa!" : ""}</div>
                            )}
                        </div>
                     </div>
                     <button onClick={(e) => { e.stopPropagation(); onFlip(); }} className={`py-2 px-4 rounded-xl text-white text-sm font-semibold flex items-center space-x-2 shadow-md transition-colors cursor-pointer z-20 relative ${isCompleted ? 'bg-slate-400' : themeClasses.btn}`}><Pencil className="w-3 h-3" /><span>Notas</span></button>
                  </div>
                </div>

                {/* BACK */}
                <div className={`absolute w-full h-full backface-hidden bg-slate-50 rounded-2xl shadow-xl border-2 p-6 rotate-y-180 flex flex-col ${themeClasses.border} ${activeCardClass}`}>
                  <div className="flex justify-between items-center mb-2">
                    <h4 className={`font-bold ${themeClasses.text} text-sm`}>Mis Notas, Fotos y Voz</h4>
                    <button onClick={(e) => { e.stopPropagation(); onFlip(); }} className="text-slate-400 hover:text-slate-600 cursor-pointer z-20"><RotateCcw className="w-5 h-5" /></button>
                  </div>
                  
                  {/* Area de Texto con Dictado */}
                  <div className="relative flex-1 mb-2">
                      <textarea 
                        className="w-full h-full p-3 bg-white border border-slate-200 rounded-lg resize-none focus:ring-2 focus:ring-orange-200 focus:outline-none text-slate-700 text-sm placeholder:text-slate-300" 
                        placeholder="Escribe o dicta aqu√≠ tus ideas clave..." 
                        value={note} 
                        onChange={(e) => onNoteChange(item.id, e.target.value)} 
                      />
                      {/* Bot√≥n Flotante de Dictado */}
                      <button 
                        onClick={toggleDictation}
                        className={`absolute bottom-3 right-3 p-2 rounded-full shadow-md transition-all duration-300 z-30 ${isDictating ? 'bg-red-500 text-white animate-pulse' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}`}
                        title={isDictating ? "Escuchando..." : "Dictar nota"}
                      >
                        {isDictating ? <MicOff className="w-4 h-4" /> : <Mic className="w-4 h-4" />}
                      </button>
                      {isDictating && <div className="absolute bottom-3 right-12 flex items-center space-x-1"><div className="dictating-wave"></div><div className="dictating-wave"></div><div className="dictating-wave"></div></div>}
                  </div>
                  
                  {/* √Årea de Multimedia */}
                  <div className="mt-auto border-t border-slate-200 pt-2 flex flex-col gap-2">
                      
                      {/* Galer√≠a de Fotos */}
                      {photos.length > 0 && (
                          <div className="flex gap-2 overflow-x-auto pb-1 h-14 items-center no-scrollbar">
                              {photos.map((photo, idx) => (
                                  <div key={idx} className="relative flex-shrink-0 w-12 h-12 group/photo">
                                    <img src={photo} alt={`Foto ${idx}`} className="w-full h-full object-cover rounded-lg border border-slate-300 shadow-sm" />
                                    <button onClick={(e) => { e.stopPropagation(); onPhotoRemove(item.id, idx); }} className="absolute -top-1 -right-1 bg-red-500 text-white rounded-full p-0.5 shadow-sm hover:bg-red-600 z-30" title="Borrar"><Trash2 className="w-2 h-2" /></button>
                                  </div>
                              ))}
                          </div>
                      )}

                      {/* Galer√≠a de Audios */}
                      {audios.length > 0 && (
                          <div className="flex flex-col gap-1 max-h-20 overflow-y-auto no-scrollbar">
                              {audios.map((audioUrl, idx) => (
                                  <div key={idx} className="flex items-center bg-slate-100 rounded-lg p-1 pr-2">
                                      <audio src={audioUrl} controls className="h-6 w-full mr-2" />
                                      <button onClick={(e) => { e.stopPropagation(); onAudioRemove(item.id, idx); }} className="text-red-400 hover:text-red-600 cursor-pointer z-30"><Trash2 className="w-4 h-4" /></button>
                                  </div>
                              ))}
                          </div>
                      )}

                      {/* Botones de Acci√≥n */}
                      <div className="flex gap-2">
                           <input type="file" accept="image/*" capture="environment" ref={fileInputRef} className="hidden" onChange={handleFileChange} />
                          
                          {/* Bot√≥n Foto */}
                          <button onClick={handleCameraClick} className="flex-1 flex items-center justify-center space-x-1 text-xs font-bold bg-white border border-slate-300 px-2 py-2 rounded-lg text-slate-600 hover:bg-slate-100 transition-colors cursor-pointer z-20">
                              <Camera className="w-4 h-4" /><span>Foto</span>
                          </button>

                          {/* Bot√≥n Audio (Grabaci√≥n de Archivo) */}
                          <button 
                            onClick={toggleRecording} 
                            className={`flex-1 flex items-center justify-center space-x-1 text-xs font-bold px-2 py-2 rounded-lg transition-colors cursor-pointer z-20 ${isRecording ? 'bg-red-500 text-white animate-pulse' : 'bg-white border border-slate-300 text-slate-600 hover:bg-slate-100'}`}
                          >
                              {isRecording ? <Square className="w-4 h-4 fill-current" /> : <Volume2 className="w-4 h-4" />}
                              <span>{isRecording ? 'Detener' : 'Grabar Audio'}</span>
                          </button>
                      </div>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        // --- MAIN APP ---
        function App() {
          const [activeTab, setActiveTab] = useState('foro');
          const [notes, setNotes] = useState({});
          const [activityStatus, setActivityStatus] = useState({}); 
          const [photos, setPhotos] = useState({}); 
          const [audios, setAudios] = useState({}); 
          const [flippedState, setFlippedState] = useState({});
          const [finalReflection, setFinalReflection] = useState("");
          const [contacts, setContacts] = useState([]);
          const [newContact, setNewContact] = useState({ name: '', org: '', info: '' });
          const [jsPDFInstance, setJsPDFInstance] = useState(null);
          
          const [currentEventStatus, setCurrentEventStatus] = useState({ current: null, next: null });

          useEffect(() => {
            const script = document.createElement('script');
            script.src = "https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js";
            script.onload = () => { setJsPDFInstance(window.jspdf); };
            document.body.appendChild(script);
          }, []);

          useEffect(() => {
              const timer = setInterval(() => {
                  const now = new Date();
                  const currentMinutes = now.getHours() * 60 + now.getMinutes();
                  const data = activeTab === 'mujeres' ? womenAgendaData : mainAgendaData;
                  setCurrentEventStatus(getCurrentEventStatus(data, currentMinutes));
              }, 1000);
              return () => clearInterval(timer);
          }, [activeTab]);

          const handleFlip = (id) => setFlippedState(prev => ({ ...prev, [id]: !prev[id] }));
          const handleNoteChange = (id, value) => setNotes(prev => ({ ...prev, [id]: value }));
          
          const handlePhotoAdd = (id, base64) => setPhotos(prev => ({ ...prev, [id]: [...(prev[id] || []), base64] }));
          const handlePhotoRemove = (id, index) => setPhotos(prev => ({ ...prev, [id]: (prev[id] || []).filter((_, idx) => idx !== index) }));
          
          const handleAudioAdd = (id, url) => setAudios(prev => ({ ...prev, [id]: [...(prev[id] || []), url] }));
          const handleAudioRemove = (id, index) => setAudios(prev => ({ ...prev, [id]: (prev[id] || []).filter((_, idx) => idx !== index) }));

          const handleStatusChange = (id, status) => setActivityStatus(prev => ({ ...prev, [id]: status }));
          
          const handleAddContact = () => {
              if (newContact.name.trim() === '') return;
              setContacts([...contacts, { ...newContact, id: Date.now() }]);
              setNewContact({ name: '', org: '', info: '' });
          };
          const handleDeleteContact = (id) => setContacts(contacts.filter(c => c.id !== id));

          // GENERAR PDF
          const downloadPDF = () => {
            if (!jsPDFInstance) { alert("Cargando generador PDF..."); return; }
            const { jsPDF } = jsPDFInstance;
            const doc = new jsPDF();
            const colors = { orange: [249, 115, 22], purple: [147, 51, 234], blue: [37, 99, 235], dark: [30, 41, 59], gray: [100, 116, 139], lightGray: [248, 250, 252] };

            doc.setFillColor(...colors.orange);
            doc.rect(0, 0, 210, 40, 'F'); 
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.setFont("helvetica", "bold");
            doc.text("Memorias del Evento", 15, 20);
            doc.setFontSize(12);
            doc.setFont("helvetica", "normal");
            doc.text("1er Foro Nacional de L√≠deres y Lideresas por la Seguridad Vial", 15, 30);

            let y = 55;
            const checkPageBreak = (heightNeeded) => {
                if (y + heightNeeded > 270) { doc.addPage(); y = 20; return true; }
                return false;
            };

            const writeSection = (data, sectionTitle, themeColor) => {
                checkPageBreak(30);
                doc.setFillColor(...themeColor);
                doc.rect(15, y, 180, 10, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(12);
                doc.setFont("helvetica", "bold");
                doc.text(sectionTitle.toUpperCase(), 20, y + 7);
                y += 20;

                if (sectionTitle === "Encuentro de Mujeres") {
                     doc.setTextColor(37, 99, 235);
                     doc.setFontSize(10);
                     doc.setFont("helvetica", "normal");
                     doc.textWithLink("Acceder a los recursos del taller (Click aqu√≠)", 20, y, { url: "https://neoseguridadvial.github.io/1rforo/mujeres.html" });
                     y += 10;
                }

                data.forEach(item => {
                    const note = notes[item.id];
                    const status = activityStatus[item.id];
                    const itemPhotos = photos[item.id] || [];
                    const itemAudios = audios[item.id] || [];
                    
                    if ((note && note.trim().length > 0) || status || itemPhotos.length > 0 || itemAudios.length > 0) {
                        let contentHeight = 20; 
                        let noteHeight = 0;
                        let photoHeight = 0;
                        let audioHeight = 0;

                        let splitNotes = [];
                        if (note && note.trim().length > 0) {
                             splitNotes = doc.splitTextToSize(note, 165); 
                             noteHeight = (splitNotes.length * 5) + 15;
                             contentHeight += noteHeight;
                        }
                        if (itemPhotos.length > 0) {
                            const rows = Math.ceil(itemPhotos.length / 2);
                            photoHeight = (rows * 60) + 5;
                            contentHeight += photoHeight;
                        }
                        if (itemAudios.length > 0) { audioHeight = 10; contentHeight += audioHeight; }

                        checkPageBreak(contentHeight + 10);
                        doc.setDrawColor(...themeColor); doc.setLineWidth(0.5); doc.line(15, y, 15, y + contentHeight);
                        doc.setFillColor(...themeColor); doc.circle(15, y, 2, 'F'); 
                        doc.setTextColor(...colors.gray); doc.setFontSize(10); doc.setFont("helvetica", "bold");
                        doc.text(item.time, 22, y + 1);
                        let statusText = status === 'interested' ? "‚≠ê Inter√©s" : status === 'completed' ? "‚úÖ Asisti√≥" : "";
                        if (statusText) { doc.setFont("helvetica", "italic"); doc.setFontSize(9); doc.setTextColor(...themeColor); doc.text(statusText, 22 + doc.getTextWidth(item.time) + 5, y + 1); }
                        y += 6;
                        doc.setTextColor(...colors.dark); doc.setFontSize(12); doc.setFont("helvetica", "bold");
                        const splitTitle = doc.splitTextToSize(item.title, 165); doc.text(splitTitle, 22, y);
                        y += (splitTitle.length * 6) + 2;
                        
                        if (splitNotes.length > 0) { doc.setFillColor(...colors.lightGray); doc.rect(22, y, 170, noteHeight - 5, 'F'); doc.setTextColor(...colors.dark); doc.setFontSize(10); doc.setFont("helvetica", "normal"); doc.text(splitNotes, 25, y + 6); y += noteHeight; }
                        
                        if (itemAudios.length > 0) {
                            doc.setTextColor(...colors.blue);
                            doc.setFontSize(10);
                            doc.setFont("helvetica", "italic");
                            doc.text(`üîä ${itemAudios.length} nota(s) de voz adjunta(s) (Ver en App)`, 22, y + 2);
                            y += audioHeight;
                        }

                        if (itemPhotos.length > 0) { itemPhotos.forEach((photo, idx) => { try { doc.addImage(photo, 'JPEG', 22 + ((idx % 2) * 88), y + (Math.floor(idx / 2) * 60), 80, 50); } catch (e) {} }); y += photoHeight; }
                        y += 8;
                    }
                });
                y += 10;
            };

            writeSection(mainAgendaData, "Agenda Foro Nacional", colors.orange);
            writeSection(womenAgendaData, "Encuentro de Mujeres", colors.purple);

            if (contacts.length > 0) {
                checkPageBreak(40);
                doc.setFillColor(...colors.blue); doc.rect(15, y, 180, 10, 'F');
                doc.setTextColor(255, 255, 255); doc.setFontSize(12); doc.setFont("helvetica", "bold"); doc.text("RED DE CONTACTOS", 20, y + 7); y += 20;
                contacts.forEach(c => {
                    checkPageBreak(25); doc.setDrawColor(...colors.blue); doc.setLineWidth(0.5); doc.rect(15, y, 180, 20); doc.setFillColor(...colors.blue); doc.rect(15, y, 5, 20, 'F');
                    doc.setTextColor(...colors.dark); doc.setFontSize(11); doc.setFont("helvetica", "bold"); doc.text(c.name, 25, y + 7);
                    doc.setTextColor(...colors.gray); doc.setFontSize(10); doc.setFont("helvetica", "normal"); doc.text(`${c.org} | ${c.info}`, 25, y + 14); y += 25;
                });
            }

            if (finalReflection.trim().length > 0) {
                checkPageBreak(50); doc.setDrawColor(...colors.orange); doc.setLineWidth(1); doc.rect(15, y, 180, 40);
                doc.setTextColor(...colors.orange); doc.setFontSize(14); doc.setFont("helvetica", "bold"); doc.text("¬øQu√© me queda del evento?", 20, y + 10);
                doc.setTextColor(...colors.dark); doc.setFontSize(11); doc.setFont("helvetica", "italic"); doc.text(doc.splitTextToSize(finalReflection, 170), 20, y + 20);
            }

            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) { doc.setPage(i); doc.setFontSize(8); doc.setTextColor(150); doc.text(`P√°gina ${i} de ${pageCount}`, 195, 290, null, null, "right"); }
            doc.save("Memorias_Foro_Seguridad_Vial.pdf");
          };

          // GENERAR HTML PORT√ÅTIL (CON AUDIO)
          const downloadHTML = () => {
              let htmlContent = `
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memorias - 1er Foro Nacional</title>
    <script src="https://cdn.tailwindcss.com"></` + `script>
</head>
<body class="bg-slate-50 text-slate-800 p-6 lg:p-12 max-w-5xl mx-auto">
    <header class="mb-10 text-center border-b-4 border-orange-500 pb-6">
        <h1 class="text-3xl font-extrabold text-orange-600 mb-2">Memorias del Evento</h1>
        <p class="text-xl text-slate-600">1er Foro Nacional de L√≠deres y Lideresas por la Seguridad Vial</p>
        <p class="text-sm text-slate-400 mt-2">Generado el: ${new Date().toLocaleDateString()}</p>
    </header>

    <div class="space-y-12">
`;

              // Funci√≥n auxiliar para renderizar una secci√≥n en HTML
              const renderSection = (data, title, color) => {
                  let sectionHtml = "";
                  let hasContent = false;

                  data.forEach(item => {
                      const note = notes[item.id];
                      const itemPhotos = photos[item.id] || [];
                      const itemAudios = audios[item.id] || [];
                      const status = activityStatus[item.id];

                      if ((note && note.trim().length > 0) || status || itemPhotos.length > 0 || itemAudios.length > 0) {
                          hasContent = true;
                          sectionHtml += `
                            <div class="bg-white p-6 rounded-xl shadow-md border-l-4 border-${color}-500 mb-6">
                                <div class="flex justify-between items-start mb-4">
                                    <div>
                                        <span class="text-xs font-bold uppercase text-${color}-600 bg-${color}-100 px-2 py-1 rounded">${item.time}</span>
                                        <h3 class="text-lg font-bold text-slate-800 mt-1">${item.title}</h3>
                                        <p class="text-sm text-slate-500">${item.moderator}</p>
                                    </div>
                                    ${status === 'interested' ? '<span class="text-yellow-500 font-bold text-sm">‚≠ê Inter√©s</span>' : ''}
                                    ${status === 'completed' ? '<span class="text-green-500 font-bold text-sm">‚úÖ Asisti√≥</span>' : ''}
                                </div>

                                ${note ? `<div class="bg-slate-50 p-4 rounded-lg text-slate-700 text-sm mb-4 italic border border-slate-200">"${note}"</div>` : ''}

                                ${itemAudios.length > 0 ? `
                                    <div class="mb-4">
                                        <h4 class="text-xs font-bold text-slate-400 uppercase mb-2">Notas de Voz:</h4>
                                        <div class="grid grid-cols-1 gap-2">
                                            ${itemAudios.map(url => `<audio controls src="${url}" class="w-full h-8"></audio>`).join('')}
                                        </div>
                                    </div>
                                ` : ''}

                                ${itemPhotos.length > 0 ? `
                                    <div>
                                        <h4 class="text-xs font-bold text-slate-400 uppercase mb-2">Galer√≠a:</h4>
                                        <div class="flex gap-2 overflow-x-auto pb-2">
                                            ${itemPhotos.map(url => `<img src="${url}" class="h-32 rounded-lg shadow-sm border border-slate-200" />`).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                          `;
                      }
                  });

                  if (hasContent) {
                      htmlContent += `
                        <section>
                            <h2 class="text-2xl font-bold text-${color}-600 mb-6 border-b border-slate-200 pb-2">${title}</h2>
                            ${sectionHtml}
                        </section>
                      `;
                  }
              };

              renderSection(mainAgendaData, "Agenda Foro Nacional", "orange");
              renderSection(womenAgendaData, "Encuentro de Mujeres", "purple");

              // Contactos
              if (contacts.length > 0) {
                  htmlContent += `
                    <section>
                        <h2 class="text-2xl font-bold text-blue-600 mb-6 border-b border-slate-200 pb-2">Red de Contactos</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${contacts.map(c => `
                                <div class="bg-white p-4 rounded-lg shadow border-l-4 border-blue-500">
                                    <h4 class="font-bold text-slate-800">${c.name}</h4>
                                    <p class="text-sm text-slate-500">${c.org}</p>
                                    <p class="text-sm text-blue-600">${c.info}</p>
                                </div>
                            `).join('')}
                        </div>
                    </section>
                  `;
              }

              // Reflexi√≥n
              if (finalReflection) {
                  htmlContent += `
                    <section class="mt-12 bg-orange-50 p-8 rounded-2xl border border-orange-200">
                        <h2 class="text-2xl font-bold text-orange-800 mb-4">¬øQu√© me queda del evento?</h2>
                        <p class="text-slate-700 italic text-lg leading-relaxed">"${finalReflection}"</p>
                    </section>
                  `;
              }

              htmlContent += `
    </div>
    <footer class="mt-20 text-center text-slate-400 text-sm pb-10">
        <p>Generado autom√°ticamente por la App de Memorias del Foro.</p>
    </footer>
</body>
</html>`;

              const blob = new Blob([htmlContent], { type: 'text/html' });
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = 'Mis_Memorias_Foro.html';
              a.click();
          };

          return (
            <div className="min-h-screen bg-slate-100 font-sans selection:bg-orange-200 selection:text-orange-900 pb-24">
              
              {/* LIVE TICKER */}
              <LiveTicker currentStatus={currentEventStatus} />

              {/* LOGO STRIP */}
              <div className="bg-white py-4 px-6 flex justify-center shadow-sm relative z-30">
                <img src="https://imgur.com/jrW2403.png" alt="Logo ANSV" className="h-16 md:h-20 object-contain" onError={(e) => e.target.style.display = 'none'} />
              </div>

              {/* HERO HEADER */}
              <header className="bg-gradient-to-br from-orange-500 to-orange-600 text-white pt-8 pb-24 px-4 shadow-lg relative overflow-hidden">
                <div className="absolute top-0 left-0 w-64 h-64 bg-white opacity-5 rounded-full -translate-x-1/2 -translate-y-1/2 blur-3xl"></div>
                <div className="absolute bottom-0 right-0 w-96 h-96 bg-orange-400 opacity-20 rounded-full translate-x-1/3 translate-y-1/3 blur-3xl"></div>
                <div className="max-w-4xl mx-auto text-center relative z-10">
                  <h1 className="text-3xl md:text-5xl font-extrabold tracking-tight mb-2 drop-shadow-sm">1er Foro Nacional</h1>
                  <p className="text-orange-100 text-lg md:text-xl font-light">L√≠deres y Lideresas por la Seguridad Vial</p>
                </div>
              </header>

              {/* NUEVA FICHA DEL EVENTO (RESUMEN) */}
              <EventSummaryCard />

              {/* INSTRUCTIONS SECTION */}
              <div className="max-w-4xl mx-auto px-4 relative z-20 mb-8 mt-8">
                  <div className="bg-white rounded-2xl shadow-xl border-l-8 border-orange-400 p-6 flex flex-col md:flex-row items-start md:items-center gap-4">
                      <div className="bg-orange-100 p-3 rounded-full text-orange-600 flex-shrink-0"><Info className="w-8 h-8" /></div>
                      <div className="flex-1">
                          <h3 className="text-xl font-bold text-slate-800 mb-2 flex items-center">Agenda y toma de memorias</h3>
                          <div className="text-slate-600 text-sm space-y-2">
                              <p><strong>Lo que puedes hacer:</strong> Marcar actividades de inter√©s, tomar notas, grabar audio y agregar m√∫ltiples fotos por sesi√≥n.</p>
                              <p className="flex items-start text-orange-700 font-medium bg-orange-50 p-2 rounded-lg">
                                  <AlertTriangle className="w-4 h-4 mr-2 mt-0.5 flex-shrink-0" />
                                  <span><strong>¬°Importante!</strong> La informaci√≥n se guarda temporalmente. Descarga tus memorias antes de salir.</span>
                              </p>
                          </div>
                      </div>
                      <div className="flex flex-col gap-2">
                          <button onClick={downloadPDF} className="flex items-center justify-center bg-slate-800 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-slate-900 transition-colors w-full">
                              <Download className="w-4 h-4 mr-2" />PDF
                          </button>
                          <button onClick={downloadHTML} className="flex items-center justify-center bg-purple-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-purple-700 transition-colors w-full">
                              <FileCode className="w-4 h-4 mr-2" />HTML (Audio)
                          </button>
                      </div>
                  </div>
              </div>

              {/* MAIN CONTENT */}
              <main className="max-w-6xl mx-auto px-4 relative z-20 pb-24">
                <div className="flex justify-center mb-8">
                  <div className="bg-white p-1.5 rounded-2xl shadow-xl flex flex-wrap md:flex-nowrap gap-2 w-full max-w-2xl">
                    <button onClick={() => setActiveTab('foro')} className={`flex-1 py-3 px-4 rounded-xl font-bold text-sm md:text-base transition-all duration-300 flex items-center justify-center ${activeTab === 'foro' ? 'bg-orange-500 text-white shadow-md transform scale-105' : 'text-slate-500 hover:bg-slate-50'}`}><Users className="w-5 h-5 mr-2" />Foro Nacional</button>
                    <button onClick={() => setActiveTab('mujeres')} className={`flex-1 py-3 px-4 rounded-xl font-bold text-sm md:text-base transition-all duration-300 flex items-center justify-center ${activeTab === 'mujeres' ? 'bg-purple-600 text-white shadow-md transform scale-105' : 'text-slate-500 hover:bg-slate-50'}`}><Award className="w-5 h-5 mr-2" />Encuentro Mujeres</button>
                    <button onClick={() => setActiveTab('contactos')} className={`flex-1 py-3 px-4 rounded-xl font-bold text-sm md:text-base transition-all duration-300 flex items-center justify-center ${activeTab === 'contactos' ? 'bg-blue-600 text-white shadow-md transform scale-105' : 'text-slate-500 hover:bg-slate-50'}`}><Briefcase className="w-5 h-5 mr-2" />Mis Contactos</button>
                  </div>
                </div>

                <div className="transition-opacity duration-300 min-h-[600px]">
                   {activeTab === 'foro' && (
                      <div className="animate-fade-in-up grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                          {mainAgendaData.map((item) => <FlipCard key={item.id} item={item} note={notes[item.id] || ''} onNoteChange={handleNoteChange} status={activityStatus[item.id]} onStatusChange={handleStatusChange} isFlipped={!!flippedState[item.id]} onFlip={() => handleFlip(item.id)} photos={photos[item.id] || []} onPhotoAdd={handlePhotoAdd} onPhotoRemove={handlePhotoRemove} audios={audios[item.id] || []} onAudioAdd={handleAudioAdd} onAudioRemove={handleAudioRemove} colorTheme="orange" isCurrent={currentEventStatus.current?.id === item.id} />)}
                      </div>
                   )}
                   {activeTab === 'mujeres' && (
                      <div className="animate-fade-in-up">
                          <div className="bg-purple-100 border-l-4 border-purple-500 p-6 rounded-r-xl mb-8 shadow-sm flex flex-col md:flex-row gap-4 items-start justify-between">
                                <div className="flex items-start"><Layout className="w-8 h-8 text-purple-600 mr-4 mt-1" /><div><h3 className="font-bold text-xl text-purple-900">Agenda Paralela</h3><p className="text-purple-700 mb-2">Este encuentro se realiza simult√°neamente con el Foro Nacional.</p></div></div>
                                <a href="https://neoseguridadvial.github.io/1rforo/mujeres.html" target="_blank" rel="noopener noreferrer" className="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg transition-colors flex items-center shadow-md"><ExternalLink className="w-5 h-5 mr-2" />Ver Recursos</a>
                          </div>
                          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                              {womenAgendaData.map((item) => <FlipCard key={item.id} item={item} note={notes[item.id] || ''} onNoteChange={handleNoteChange} status={activityStatus[item.id]} onStatusChange={handleStatusChange} isFlipped={!!flippedState[item.id]} onFlip={() => handleFlip(item.id)} photos={photos[item.id] || []} onPhotoAdd={handlePhotoAdd} onPhotoRemove={handlePhotoRemove} audios={audios[item.id] || []} onAudioAdd={handleAudioAdd} onAudioRemove={handleAudioRemove} colorTheme="purple" isCurrent={currentEventStatus.current?.id === item.id} />)}
                          </div>
                      </div>
                   )}
                   {activeTab === 'contactos' && (
                       <div className="animate-fade-in-up max-w-4xl mx-auto">
                            <div className="bg-white rounded-3xl shadow-xl p-8 border border-slate-100 mb-8">
                                <h3 className="text-xl font-bold text-slate-800 mb-6 flex items-center"><PlusCircle className="w-6 h-6 text-blue-600 mr-2" />A√±adir Nuevo Contacto</h3>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                    <input type="text" placeholder="Nombre Completo" className="p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none w-full" value={newContact.name} onChange={(e) => setNewContact({...newContact, name: e.target.value})} />
                                    <input type="text" placeholder="Organizaci√≥n / Rol" className="p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none w-full" value={newContact.org} onChange={(e) => setNewContact({...newContact, org: e.target.value})} />
                                    <input type="text" placeholder="Celular o Email" className="p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none w-full" value={newContact.info} onChange={(e) => setNewContact({...newContact, info: e.target.value})} />
                                </div>
                                <button onClick={handleAddContact} disabled={!newContact.name} className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"><Save className="w-5 h-5 mr-2" />Guardar Contacto</button>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {contacts.length === 0 ? (
                                    <div className="col-span-full text-center py-10 text-slate-400"><Users className="w-16 h-16 mx-auto mb-4 opacity-20" /><p>A√∫n no has a√±adido contactos.</p></div>
                                ) : (
                                    contacts.map(contact => (
                                        <div key={contact.id} className="bg-white p-6 rounded-2xl shadow-md border-l-4 border-blue-500 flex justify-between items-start hover:shadow-lg transition-shadow">
                                            <div><h4 className="font-bold text-lg text-slate-800">{contact.name}</h4><div className="flex items-center text-slate-500 text-sm mt-1"><Briefcase className="w-3 h-3 mr-2" />{contact.org || 'Sin organizaci√≥n'}</div><div className="flex items-center text-slate-500 text-sm mt-1"><Phone className="w-3 h-3 mr-2" />{contact.info || 'Sin contacto'}</div></div>
                                            <button onClick={() => handleDeleteContact(contact.id)} className="text-red-300 hover:text-red-500 transition-colors p-2"><Trash2 className="w-5 h-5" /></button>
                                        </div>
                                    ))
                                )}
                            </div>
                       </div>
                   )}
                </div>

                <div className="mt-16 bg-white rounded-3xl shadow-xl p-8 border border-slate-100 relative overflow-hidden">
                    <div className="absolute top-0 left-0 w-2 h-full bg-orange-400"></div>
                    <div className="relative z-10">
                        <h2 className="text-2xl md:text-3xl font-bold text-slate-800 mb-2">¬øQu√© me queda del evento?</h2>
                        <p className="text-slate-500 mb-6">T√≥mate un momento para escribir tus aprendizajes m√°s valiosos. Esto se incluir√° en tu PDF.</p>
                        <textarea value={finalReflection} onChange={(e) => setFinalReflection(e.target.value)} className="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500 focus:outline-none min-h-[150px] text-slate-700 shadow-inner transition-all hover:bg-white" placeholder="Mis mayores aprendizajes hoy fueron..." />
                    </div>
                    <Heart className="absolute -bottom-6 -right-6 w-40 h-40 text-orange-50 opacity-50 transform rotate-12" />
                </div>
              </main>

              {/* NUEVO BOT√ìN VOLVER AL INICIO */}
              <ScrollToTopButton />

              <div className="fixed bottom-8 right-8 z-50 flex flex-col gap-3 items-end">
                  <button onClick={downloadHTML} className="bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-full shadow-2xl flex items-center transition-all hover:scale-105 group" title="Descargar HTML con Audio">
                      <FileCode className="w-6 h-6" />
                      <span className="max-w-0 overflow-hidden group-hover:max-w-xs group-hover:ml-3 transition-all duration-500 whitespace-nowrap font-bold">Descargar con Audio</span>
                  </button>
                  <button onClick={downloadPDF} className="bg-slate-900 hover:bg-black text-white p-4 rounded-full shadow-2xl flex items-center transition-all hover:scale-105 group" title="Generar PDF">
                      <Download className="w-6 h-6" />
                      <span className="max-w-0 overflow-hidden group-hover:max-w-xs group-hover:ml-3 transition-all duration-500 whitespace-nowrap font-bold">Descargar PDF</span>
                  </button>
              </div>
            </div>
          );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
