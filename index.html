<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda 1er Foro Nacional - ANSV</title>
    
    <!-- Tailwind CSS (Estilos) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configuración de Animaciones Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    keyframes: {
                        'fade-in-up': {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        'pulse-slow': {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.5' },
                        },
                        'glow': {
                            '0%, 100%': { boxShadow: '0 0 15px rgba(249, 115, 22, 0.5), 0 0 30px rgba(249, 115, 22, 0.3)' },
                            '50%': { boxShadow: '0 0 25px rgba(249, 115, 22, 0.8), 0 0 50px rgba(249, 115, 22, 0.5)' },
                        }
                    },
                    animation: {
                        'fade-in-up': 'fade-in-up 0.5s ease-out',
                        'pulse-slow': 'pulse-slow 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'glow': 'glow 2s infinite',
                    }
                }
            }
        }
    </script>

    <!-- Babel (Traductor de React para el navegador) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Estilos para efectos 3D de las tarjetas -->
    <style>
        html { scroll-behavior: smooth; }
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        
        /* USAMOS !important PARA FORZAR EL GIRO SOBRE TAILWIND */
        .rotate-y-180 { transform: rotateY(180deg) !important; }
        .preserve-3d { transform-style: preserve-3d; }
        
        /* Ocultar scrollbar en galería de fotos */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-slate-100" id="top">
    
    <div id="root"></div>

    <!-- Tu Aplicación React -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        
        // Importamos Lucide Icons
        import { 
          Clock, User, RotateCcw, Pencil, Download, MapPin, Calendar, Mic, Users, 
          Coffee, Award, MessageSquare, CheckCircle, Star, Layout, Heart, Camera, 
          Trash2, PlusCircle, Briefcase, Phone, Save, Info, AlertTriangle, Link, ExternalLink,
          Radio, ArrowUp, Target, MonitorPlay, Zap
        } from 'https://esm.sh/lucide-react@0.263.1';

        // --- DATA SOURCE ---
        const mainAgendaData = [
          { id: 'm0', time: '07:30 - 08:00', duration: '30 min', title: 'Registro y Acreditación', moderator: 'Equipo logístico REDIPI', description: 'Registro de participantes presenciales y entrega de escarapelas con QR.', icon: 'check' },
          { id: 'm1', time: '08:00 - 08:10', duration: '10 min', title: 'Instalación Oficial', moderator: 'Representante ANSV / Maestro de ceremonias', description: 'Acto protocolario, himnos y palabras de apertura.', icon: 'mic' },
          { id: 'm2', time: '08:10 - 08:50', duration: '40 min', title: 'Innovación, Tecnología y Liderazgo Empresarial', moderator: 'Daniel Villaveces', description: 'Vehículos seguros, infraestructura inteligente y liderazgo en gestión.', icon: 'lightbulb' },
          { id: 'm3', time: '08:50 - 09:40', duration: '50 min', title: 'Socialización Iniciativas (Bloque 1)', moderator: 'Líderes/as Ponentes', description: 'Presentación de proyectos ganadores (5 presentaciones).', icon: 'users' },
          { id: 'm4', time: '09:40 - 10:00', duration: '20 min', title: 'Pausa Activa y Networking', moderator: 'Equipo logístico', description: 'Disparador de conversación: logros y desafíos.', icon: 'coffee' },
          { id: 'm5', time: '10:00 - 10:40', duration: '40 min', title: 'Liderazgo Comunitario y Cultural', moderator: 'Sandra Milena Tapias', description: 'Liderazgo de la sociedad civil, víctimas y transformación cultural.', icon: 'heart' },
          { id: 'm6', time: '10:40 - 11:30', duration: '50 min', title: 'Socialización Iniciativas (Bloque 2)', moderator: 'Líderes/as Ponentes', description: 'Continuación de presentación de proyectos ganadores.', icon: 'users' },
          { id: 'm7', time: '11:30 - 12:10', duration: '50 min', title: 'Taller: Fortalecimiento de la Red', moderator: 'Facilitador/a REDIPI', description: 'Dinámica "Conectemos nuestros liderazgos" y compromisos de Red.', icon: 'puzzle' },
          { id: 'm8', time: '12:10 - 13:40', duration: '90 min', title: 'Almuerzo Libre', moderator: '-', description: 'Tiempo libre para alimentación.', icon: 'coffee' },
          { id: 'm9', time: '13:40 - 14:20', duration: '40 min', title: 'Liderazgo Gubernamental y Gobernanza', moderator: 'Aida Luz Ospina', description: 'Estrategia Nacional y coordinación intersectorial.', icon: 'building' },
          { id: 'm10', time: '14:20 - 14:40', duration: '20 min', title: 'Pausa Café y Networking Libre', moderator: 'Equipo logístico', description: 'Espacio distendido para interacción espontánea.', icon: 'coffee' },
          { id: 'm11', time: '14:40 - 15:40', duration: '60 min', title: 'Panel: Liderazgos Transformadores', moderator: 'Rep. ANSV (Modera) / 3 Expertos', description: 'Conversatorio sobre cualidades del líder y experiencias de éxito.', icon: 'mic' },
          { id: 'm12', time: '15:40 - 16:15', duration: '35 min', title: 'Socialización Iniciativas (Bloque 3)', moderator: 'Líderes/as Ponentes', description: 'Proyectos con reconocimiento especial.', icon: 'star' },
          { id: 'm13', time: '16:15 - 16:45', duration: '30 min', title: 'Entrega de Certificados', moderator: 'Rep. ANSV / Maestro de ceremonias', description: 'Reconocimiento al Top 10 y entrega de certificados.', icon: 'award' },
          { id: 'm14', time: '16:45 - 17:00', duration: '15 min', title: 'Cierre del Evento', moderator: 'Rep. ANSV / Facilitador REDIPI', description: 'Conclusiones y resultados del proceso formativo.', icon: 'flag' }
        ];

        const womenAgendaData = [
          { id: 'w1', time: '10:00 - 10:05', duration: '5 min', title: 'Bienvenida Encuentro Mujeres', moderator: 'Facilitadora REDIPI', description: 'Apertura guiada y conexión a sala digital.', icon: 'heart' },
          { id: 'w2', time: '10:05 - 10:25', duration: '20 min', title: 'Mapa Digital: Modos de Movilidad', moderator: 'Facilitadora REDIPI', description: 'Cartografía colaborativa sobre cargas del cuidado y rutas poligonales.', icon: 'map' },
          { id: 'w3', time: '10:25 - 10:40', duration: '15 min', title: 'Identificación de Barreras Invisibles', moderator: 'Facilitadora REDIPI', description: 'Análisis de riesgos y cifras ANSV con enfoque de género.', icon: 'alert' },
          { id: 'w4', time: '10:40 - 10:55', duration: '15 min', title: 'Testimonios: Rutas que Inspiran', moderator: 'Lideresas invitadas', description: 'Narrativa testimonial y escucha activa.', icon: 'message' },
          { id: 'w5', time: '10:55 - 11:15', duration: '20 min', title: 'Co-creación: Territorio que Cuida', moderator: 'Facilitadora + Grupos', description: 'Diseño participativo de soluciones.', icon: 'users' },
          { id: 'w6', time: '11:15 - 11:20', duration: '5 min', title: 'Cierre Sonoro: Voces que Dejan Eco', moderator: 'Facilitadora REDIPI', description: 'Microtestimonios sonoros con IA.', icon: 'mic' },
          { id: 'w7', time: '11:20 - 11:30', duration: '10 min', title: 'Cierre y Retorno a Plenaria', moderator: 'Facilitadora REDIPI', description: 'Transición al auditorio principal.', icon: 'rotate' }
        ];

        // --- HELPER FUNCTIONS ---
        const parseTime = (timeStr) => {
            if (!timeStr) return 0;
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        };

        const getCurrentEventStatus = (agendaData, currentMinutes) => {
            let current = null;
            let next = null;
            const sortedData = [...agendaData].sort((a, b) => parseTime(a.time.split(' - ')[0]) - parseTime(b.time.split(' - ')[0]));

            for (let i = 0; i < sortedData.length; i++) {
                const item = sortedData[i];
                const times = item.time.split(' - ');
                const start = parseTime(times[0]);
                const end = parseTime(times[1]);

                if (currentMinutes >= start && currentMinutes < end) {
                    current = item;
                    next = sortedData[i + 1] || null;
                    break; 
                }
                if (currentMinutes < start) {
                    if (!next) next = item;
                    break;
                }
            }
            return { current, next };
        };

        // --- COMPONENTS ---

        // 1. Botón Volver al Inicio
        const ScrollToTopButton = () => {
            const [visible, setVisible] = useState(false);

            useEffect(() => {
                const toggleVisibility = () => {
                    if (window.pageYOffset > 300) {
                        setVisible(true);
                    } else {
                        setVisible(false);
                    }
                };
                window.addEventListener("scroll", toggleVisibility);
                return () => window.removeEventListener("scroll", toggleVisibility);
            }, []);

            const scrollToTop = () => {
                window.scrollTo({ top: 0, behavior: "smooth" });
            };

            return (
                <button 
                    onClick={scrollToTop}
                    className={`fixed bottom-8 left-8 z-50 bg-white text-orange-600 p-4 rounded-full shadow-2xl border border-orange-200 transition-all duration-300 transform hover:scale-110 hover:bg-orange-50 ${visible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-10 pointer-events-none'}`}
                    title="Volver al inicio"
                >
                    <ArrowUp className="w-6 h-6" />
                </button>
            );
        };

        // 2. Ficha del Evento
        const EventSummaryCard = () => {
            return (
                <div className="max-w-6xl mx-auto px-4 relative z-20 -mt-12 mb-12">
                    <div className="bg-white rounded-2xl shadow-xl p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 border border-slate-100">
                        <div className="flex items-start space-x-3">
                            <div className="bg-orange-100 p-3 rounded-xl text-orange-600"><Calendar className="w-6 h-6" /></div>
                            <div><h4 className="text-sm font-bold text-slate-400 uppercase tracking-wider">Fecha</h4><p className="font-bold text-slate-800">24 Nov, 2025</p></div>
                        </div>
                        <div className="flex items-start space-x-3">
                            <div className="bg-blue-100 p-3 rounded-xl text-blue-600"><MapPin className="w-6 h-6" /></div>
                            <div><h4 className="text-sm font-bold text-slate-400 uppercase tracking-wider">Lugar</h4><p className="font-bold text-slate-800 text-sm leading-tight">Auditorio Edificio Elemento, Bogotá</p></div>
                        </div>
                        <div className="flex items-start space-x-3">
                            <div className="bg-green-100 p-3 rounded-xl text-green-600"><Target className="w-6 h-6" /></div>
                            <div>
                                <h4 className="text-sm font-bold text-slate-400 uppercase tracking-wider">Propósito</h4>
                                <p className="font-bold text-slate-800 text-sm leading-tight line-clamp-2">Reconocimiento y Consolidación de la Red</p>
                            </div>
                        </div>
                        <div className="flex items-start space-x-3">
                            <div className="bg-red-100 p-3 rounded-xl text-red-600"><MonitorPlay className="w-6 h-6" /></div>
                            <div><h4 className="text-sm font-bold text-slate-400 uppercase tracking-wider">Transmisión</h4><p className="font-bold text-slate-800 text-sm">YouTube ANSV / Google Meet</p></div>
                        </div>
                    </div>
                </div>
            );
        };

        // 3. Live Ticker (Simplificado ahora que App maneja el estado)
        const LiveTicker = ({ currentStatus }) => {
            const [time, setTime] = useState(new Date());

            useEffect(() => {
                const timer = setInterval(() => setTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            const formatTime = (date) => date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            return (
                <div className="sticky top-0 z-40 bg-slate-900 text-white shadow-xl border-b-4 border-orange-500 transition-all duration-300">
                    <div className="max-w-6xl mx-auto px-4 py-3 flex flex-col sm:flex-row items-center justify-between gap-4">
                        <div className="flex items-center bg-slate-800 px-4 py-2 rounded-lg shadow-inner border border-slate-700">
                            <Clock className="w-5 h-5 text-orange-400 mr-2 animate-pulse" />
                            <span className="text-xl font-mono font-bold tracking-wider">{formatTime(time)}</span>
                        </div>
                        <div className="flex-1 w-full sm:w-auto text-center sm:text-left flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-6">
                            {currentStatus.current ? (
                                <div className="flex items-center text-orange-100 animate-fade-in-up">
                                    <span className="flex h-3 w-3 relative mr-2">
                                      <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                                      <span className="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>
                                    </span>
                                    <span className="text-xs uppercase font-bold text-red-400 mr-2">En curso:</span>
                                    <span className="font-semibold truncate max-w-[200px] md:max-w-xs" title={currentStatus.current.title}>{currentStatus.current.title}</span>
                                </div>
                            ) : (
                                <div className="text-slate-400 text-sm italic">No hay actividad en curso ahora</div>
                            )}
                            {currentStatus.next && (
                                <div className="flex items-center text-slate-300 text-sm hidden md:flex animate-fade-in-up delay-100">
                                    <span className="text-orange-400 font-bold mr-2 text-xs uppercase">Siguiente:</span>
                                    <span className="truncate max-w-[150px] opacity-80" title={currentStatus.next.title}>{currentStatus.next.time.split(' - ')[0]} - {currentStatus.next.title}</span>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const StatusBadge = ({ status, onClick, type }) => {
          const isActive = status === type;
          let baseClasses = "p-2 rounded-full transition-all duration-300 flex items-center justify-center transform hover:scale-110 z-50 relative";
          let activeClasses = "";
          let IconComp = null;

          if (type === 'interested') {
            activeClasses = isActive ? "bg-yellow-100 text-yellow-500 shadow-inner" : "text-slate-300 hover:text-yellow-400";
            IconComp = Star;
          } else if (type === 'completed') {
            activeClasses = isActive ? "bg-green-100 text-green-600 shadow-inner" : "text-slate-300 hover:text-green-500";
            IconComp = CheckCircle;
          }
          return (
            <button onClick={(e) => { e.stopPropagation(); onClick(type); }} className={`${baseClasses} ${activeClasses}`} title={type === 'interested' ? "Me interesa" : "Ya lo vi / Asistí"}>
              <IconComp className={`w-5 h-5 ${isActive ? "fill-current" : ""}`} />
            </button>
          );
        };

        const FlipCard = ({ item, note, onNoteChange, isFlipped, onFlip, status, onStatusChange, photos = [], onPhotoAdd, onPhotoRemove, colorTheme = "orange", isCurrent }) => {
          const isCompleted = status === 'completed';
          const fileInputRef = useRef(null);
          
          const handleCameraClick = () => fileInputRef.current.click();
          const handleFileChange = (e) => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onloadend = () => onPhotoAdd(item.id, reader.result);
              reader.readAsDataURL(file);
              e.target.value = '';
            }
          };

          const themeClasses = colorTheme === 'purple' 
            ? { bg: 'bg-purple-50', border: 'border-purple-100', text: 'text-purple-700', btn: 'bg-purple-600 hover:bg-purple-700', badge: 'bg-purple-100 text-purple-800' }
            : { bg: 'bg-orange-50', border: 'border-orange-100', text: 'text-orange-700', btn: 'bg-orange-500 hover:bg-orange-600', badge: 'bg-orange-100 text-orange-800' };

          // Clase especial para el evento actual
          const activeCardClass = isCurrent ? 'ring-4 ring-orange-400 ring-opacity-50 animate-glow border-orange-500 shadow-2xl scale-[1.02]' : '';

          return (
            <div className={`relative w-full h-96 perspective-1000 group transition-transform duration-500 ${isCurrent ? 'z-10' : 'z-0'}`}>
              <div className={`relative w-full h-full transition-all duration-700 preserve-3d ${isFlipped ? 'rotate-y-180' : ''}`}>
                
                {/* FRONT */}
                <div className={`absolute w-full h-full backface-hidden bg-white rounded-2xl shadow-lg border-2 p-6 flex flex-col justify-between ${isCompleted ? 'border-slate-200 opacity-80' : themeClasses.border} ${activeCardClass}`}>
                  
                  {isCurrent && (
                      <div className="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-red-600 text-white text-[10px] font-bold px-3 py-1 rounded-full shadow-md flex items-center animate-bounce z-20">
                          <span className="w-2 h-2 bg-white rounded-full mr-1 animate-pulse"></span>
                          EN CURSO
                      </div>
                  )}

                  <div>
                    <div className="flex justify-between items-start mb-4">
                      <div className={`px-3 py-1 rounded-full text-xs font-bold ${isCompleted ? 'bg-slate-100 text-slate-500' : themeClasses.badge}`}>{item.duration}</div>
                      <div className="flex space-x-1">
                         <StatusBadge status={status} type="interested" onClick={(type) => onStatusChange(item.id, status === type ? null : type)} />
                         <StatusBadge status={status} type="completed" onClick={(type) => onStatusChange(item.id, status === type ? null : type)} />
                      </div>
                    </div>
                    <h3 className={`text-lg font-bold mb-2 leading-tight ${isCompleted ? 'text-slate-400 line-through decoration-2' : 'text-slate-800'}`}>{item.title}</h3>
                    <div className={`flex items-center text-sm mb-2 ${isCompleted ? 'text-slate-300' : 'text-slate-500'}`}><Clock className="w-4 h-4 mr-2" />{item.time}</div>
                    <div className={`flex items-center text-sm ${isCompleted ? 'text-slate-300' : 'text-slate-500'}`}><User className="w-4 h-4 mr-2" /><span className="truncate font-medium">{item.moderator}</span></div>
                  </div>
                  <div className="mt-4 flex items-center justify-between gap-2">
                     <div className="flex items-center gap-1 flex-1 overflow-hidden">
                        {photos.length > 0 ? (
                            <div className="text-xs text-green-600 flex items-center font-medium"><Camera className="w-3 h-3 mr-1" />{photos.length} foto(s)</div>
                        ) : (
                            <div className="text-xs text-slate-400 italic truncate">{isCompleted ? "Finalizada" : status === 'interested' ? "¡Te interesa!" : ""}</div>
                        )}
                     </div>
                     <button onClick={(e) => { e.stopPropagation(); onFlip(); }} className={`py-2 px-4 rounded-xl text-white text-sm font-semibold flex items-center space-x-2 shadow-md transition-colors cursor-pointer z-20 relative ${isCompleted ? 'bg-slate-400' : themeClasses.btn}`}><Pencil className="w-3 h-3" /><span>Notas</span></button>
                  </div>
                </div>

                {/* BACK */}
                <div className={`absolute w-full h-full backface-hidden bg-slate-50 rounded-2xl shadow-xl border-2 p-6 rotate-y-180 flex flex-col ${themeClasses.border} ${activeCardClass}`}>
                  <div className="flex justify-between items-center mb-2">
                    <h4 className={`font-bold ${themeClasses.text} text-sm`}>Mis Notas y Fotos</h4>
                    <button onClick={(e) => { e.stopPropagation(); onFlip(); }} className="text-slate-400 hover:text-slate-600 cursor-pointer z-20"><RotateCcw className="w-5 h-5" /></button>
                  </div>
                  <textarea className="flex-1 w-full p-3 bg-white border border-slate-200 rounded-lg resize-none focus:ring-2 focus:ring-orange-200 focus:outline-none text-slate-700 text-sm placeholder:text-slate-300 mb-2" placeholder="Escribe aquí tus ideas clave..." value={note} onChange={(e) => onNoteChange(item.id, e.target.value)} />
                  <div className="mt-auto border-t border-slate-200 pt-2">
                      <div className="flex gap-2 mb-2 overflow-x-auto pb-1 h-16 items-center no-scrollbar">
                          {photos.map((photo, idx) => (
                              <div key={idx} className="relative flex-shrink-0 w-14 h-14 group/photo">
                                <img src={photo} alt={`Foto ${idx}`} className="w-full h-full object-cover rounded-lg border border-slate-300 shadow-sm" />
                                <button onClick={(e) => { e.stopPropagation(); onPhotoRemove(item.id, idx); }} className="absolute -top-1 -right-1 bg-red-500 text-white rounded-full p-0.5 shadow-sm hover:bg-red-600 z-30" title="Borrar"><Trash2 className="w-2 h-2" /></button>
                              </div>
                          ))}
                          {photos.length === 0 && <span className="text-xs text-slate-400 italic w-full text-center">Sin fotos</span>}
                      </div>
                      <div className="flex justify-end items-center">
                           <input type="file" accept="image/*" capture="environment" ref={fileInputRef} className="hidden" onChange={handleFileChange} />
                          <button onClick={handleCameraClick} className="flex items-center space-x-1 text-xs font-bold bg-white border border-slate-300 px-3 py-2 rounded-lg text-slate-600 hover:bg-slate-100 transition-colors w-full justify-center cursor-pointer z-20"><Camera className="w-4 h-4" /><span>{photos.length > 0 ? 'Más fotos' : 'Tomar Foto'}</span></button>
                      </div>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        // --- MAIN APP ---
        function App() {
          const [activeTab, setActiveTab] = useState('foro');
          const [notes, setNotes] = useState({});
          const [activityStatus, setActivityStatus] = useState({}); 
          const [photos, setPhotos] = useState({}); 
          const [flippedState, setFlippedState] = useState({});
          const [finalReflection, setFinalReflection] = useState("");
          const [contacts, setContacts] = useState([]);
          const [newContact, setNewContact] = useState({ name: '', org: '', info: '' });
          const [jsPDFInstance, setJsPDFInstance] = useState(null);
          
          // Estado para el evento actual (calculado en App para pasarlo a las tarjetas)
          const [currentEventStatus, setCurrentEventStatus] = useState({ current: null, next: null });

          useEffect(() => {
            const script = document.createElement('script');
            script.src = "https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js";
            script.onload = () => { setJsPDFInstance(window.jspdf); };
            document.body.appendChild(script);
          }, []);

          // Efecto principal para actualizar el tiempo y estado de eventos
          useEffect(() => {
              const timer = setInterval(() => {
                  const now = new Date();
                  const currentMinutes = now.getHours() * 60 + now.getMinutes();
                  const data = activeTab === 'mujeres' ? womenAgendaData : mainAgendaData;
                  setCurrentEventStatus(getCurrentEventStatus(data, currentMinutes));
              }, 1000);
              return () => clearInterval(timer);
          }, [activeTab]); // Recalcular si cambia la pestaña

          const handleFlip = (id) => setFlippedState(prev => ({ ...prev, [id]: !prev[id] }));
          const handleNoteChange = (id, value) => setNotes(prev => ({ ...prev, [id]: value }));
          const handlePhotoAdd = (id, base64) => setPhotos(prev => ({ ...prev, [id]: [...(prev[id] || []), base64] }));
          const handlePhotoRemove = (id, index) => setPhotos(prev => ({ ...prev, [id]: (prev[id] || []).filter((_, idx) => idx !== index) }));
          const handleStatusChange = (id, status) => setActivityStatus(prev => ({ ...prev, [id]: status }));
          
          const handleAddContact = () => {
              if (newContact.name.trim() === '') return;
              setContacts([...contacts, { ...newContact, id: Date.now() }]);
              setNewContact({ name: '', org: '', info: '' });
          };
          const handleDeleteContact = (id) => setContacts(contacts.filter(c => c.id !== id));

          const downloadPDF = () => {
            if (!jsPDFInstance) { alert("Cargando generador PDF..."); return; }
            const { jsPDF } = jsPDFInstance;
            const doc = new jsPDF();
            const colors = { orange: [249, 115, 22], purple: [147, 51, 234], blue: [37, 99, 235], dark: [30, 41, 59], gray: [100, 116, 139], lightGray: [248, 250, 252] };

            doc.setFillColor(...colors.orange);
            doc.rect(0, 0, 210, 40, 'F'); 
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.setFont("helvetica", "bold");
            doc.text("Memorias del Evento", 15, 20);
            doc.setFontSize(12);
            doc.setFont("helvetica", "normal");
            doc.text("1er Foro Nacional de Líderes y Lideresas por la Seguridad Vial", 15, 30);

            let y = 55;
            const checkPageBreak = (heightNeeded) => {
                if (y + heightNeeded > 270) { doc.addPage(); y = 20; return true; }
                return false;
            };

            const writeSection = (data, sectionTitle, themeColor) => {
                checkPageBreak(30);
                doc.setFillColor(...themeColor);
                doc.rect(15, y, 180, 10, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(12);
                doc.setFont("helvetica", "bold");
                doc.text(sectionTitle.toUpperCase(), 20, y + 7);
                y += 20;

                if (sectionTitle === "Encuentro de Mujeres") {
                     doc.setTextColor(37, 99, 235);
                     doc.setFontSize(10);
                     doc.setFont("helvetica", "normal");
                     doc.textWithLink("Acceder a los recursos del taller (Click aquí)", 20, y, { url: "https://neoseguridadvial.github.io/1rforo/mujeres.html" });
                     y += 10;
                }

                data.forEach(item => {
                    const note = notes[item.id];
                    const status = activityStatus[item.id];
                    const itemPhotos = photos[item.id] || [];
                    
                    if ((note && note.trim().length > 0) || status || itemPhotos.length > 0) {
                        let contentHeight = 20; 
                        let noteHeight = 0;
                        let photoHeight = 0;
                        let splitNotes = [];
                        if (note && note.trim().length > 0) {
                             splitNotes = doc.splitTextToSize(note, 165); 
                             noteHeight = (splitNotes.length * 5) + 15;
                             contentHeight += noteHeight;
                        }
                        if (itemPhotos.length > 0) {
                            const rows = Math.ceil(itemPhotos.length / 2);
                            photoHeight = (rows * 60) + 5;
                            contentHeight += photoHeight;
                        }
                        checkPageBreak(contentHeight + 10);
                        doc.setDrawColor(...themeColor); doc.setLineWidth(0.5); doc.line(15, y, 15, y + contentHeight);
                        doc.setFillColor(...themeColor); doc.circle(15, y, 2, 'F'); 
                        doc.setTextColor(...colors.gray); doc.setFontSize(10); doc.setFont("helvetica", "bold");
                        doc.text(item.time, 22, y + 1);
                        let statusText = status === 'interested' ? "⭐ Interés" : status === 'completed' ? "✅ Asistió" : "";
                        if (statusText) { doc.setFont("helvetica", "italic"); doc.setFontSize(9); doc.setTextColor(...themeColor); doc.text(statusText, 22 + doc.getTextWidth(item.time) + 5, y + 1); }
                        y += 6;
                        doc.setTextColor(...colors.dark); doc.setFontSize(12); doc.setFont("helvetica", "bold");
                        const splitTitle = doc.splitTextToSize(item.title, 165); doc.text(splitTitle, 22, y);
                        y += (splitTitle.length * 6) + 2;
                        if (splitNotes.length > 0) { doc.setFillColor(...colors.lightGray); doc.rect(22, y, 170, noteHeight - 5, 'F'); doc.setTextColor(...colors.dark); doc.setFontSize(10); doc.setFont("helvetica", "normal"); doc.text(splitNotes, 25, y + 6); y += noteHeight; }
                        if (itemPhotos.length > 0) { itemPhotos.forEach((photo, idx) => { try { doc.addImage(photo, 'JPEG', 22 + ((idx % 2) * 88), y + (Math.floor(idx / 2) * 60), 80, 50); } catch (e) {} }); y += photoHeight; }
                        y += 8;
                    }
                });
                y += 10;
            };

            writeSection(mainAgendaData, "Agenda Foro Nacional", colors.orange);
            writeSection(womenAgendaData, "Encuentro de Mujeres", colors.purple);

            if (contacts.length > 0) {
                checkPageBreak(40);
                doc.setFillColor(...colors.blue); doc.rect(15, y, 180, 10, 'F');
                doc.setTextColor(255, 255, 255); doc.setFontSize(12); doc.setFont("helvetica", "bold"); doc.text("RED DE CONTACTOS", 20, y + 7); y += 20;
                contacts.forEach(c => {
                    checkPageBreak(25); doc.setDrawColor(...colors.blue); doc.setLineWidth(0.5); doc.rect(15, y, 180, 20); doc.setFillColor(...colors.blue); doc.rect(15, y, 5, 20, 'F');
                    doc.setTextColor(...colors.dark); doc.setFontSize(11); doc.setFont("helvetica", "bold"); doc.text(c.name, 25, y + 7);
                    doc.setTextColor(...colors.gray); doc.setFontSize(10); doc.setFont("helvetica", "normal"); doc.text(`${c.org} | ${c.info}`, 25, y + 14); y += 25;
                });
            }

            if (finalReflection.trim().length > 0) {
                checkPageBreak(50); doc.setDrawColor(...colors.orange); doc.setLineWidth(1); doc.rect(15, y, 180, 40);
                doc.setTextColor(...colors.orange); doc.setFontSize(14); doc.setFont("helvetica", "bold"); doc.text("¿Qué me queda del evento?", 20, y + 10);
                doc.setTextColor(...colors.dark); doc.setFontSize(11); doc.setFont("helvetica", "italic"); doc.text(doc.splitTextToSize(finalReflection, 170), 20, y + 20);
            }

            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) { doc.setPage(i); doc.setFontSize(8); doc.setTextColor(150); doc.text(`Página ${i} de ${pageCount}`, 195, 290, null, null, "right"); }
            doc.save("Memorias_Foro_Seguridad_Vial.pdf");
          };

          return (
            <div className="min-h-screen bg-slate-100 font-sans selection:bg-orange-200 selection:text-orange-900 pb-24">
              
              {/* LIVE TICKER - Pasa el estado actual como prop */}
              <LiveTicker currentStatus={currentEventStatus} />

              {/* LOGO STRIP */}
              <div className="bg-white py-4 px-6 flex justify-center shadow-sm relative z-30">
                <img src="https://imgur.com/jrW2403.png" alt="Logo ANSV" className="h-16 md:h-20 object-contain" onError={(e) => e.target.style.display = 'none'} />
              </div>

              {/* HERO HEADER */}
              <header className="bg-gradient-to-br from-orange-500 to-orange-600 text-white pt-10 pb-32 px-4 shadow-lg relative overflow-hidden">
                <div className="absolute top-0 left-0 w-64 h-64 bg-white opacity-5 rounded-full -translate-x-1/2 -translate-y-1/2 blur-3xl"></div>
                <div className="absolute bottom-0 right-0 w-96 h-96 bg-orange-400 opacity-20 rounded-full translate-x-1/3 translate-y-1/3 blur-3xl"></div>
                <div className="max-w-4xl mx-auto text-center relative z-10">
                  <h1 className="text-3xl md:text-5xl font-extrabold tracking-tight mb-2 drop-shadow-sm">1er Foro Nacional</h1>
                  <p className="text-orange-100 text-lg md:text-xl font-light">Líderes y Lideresas por la Seguridad Vial</p>
                </div>
              </header>

              {/* NUEVA FICHA DEL EVENTO (RESUMEN) */}
              <EventSummaryCard />

              {/* INSTRUCTIONS SECTION */}
              <div className="max-w-4xl mx-auto px-4 -mt-12 relative z-20 mb-8">
                  <div className="bg-white rounded-2xl shadow-xl border-l-8 border-orange-400 p-6 flex flex-col md:flex-row items-start md:items-center gap-4">
                      <div className="bg-orange-100 p-3 rounded-full text-orange-600 flex-shrink-0"><Info className="w-8 h-8" /></div>
                      <div className="flex-1">
                          <h3 className="text-xl font-bold text-slate-800 mb-2 flex items-center">Agenda y toma de memorias</h3>
                          <div className="text-slate-600 text-sm space-y-2">
                              <p><strong>Lo que puedes hacer:</strong> Marcar actividades de interés, tomar notas y agregar múltiples fotos por sesión.</p>
                              <p className="flex items-start text-orange-700 font-medium bg-orange-50 p-2 rounded-lg">
                                  <AlertTriangle className="w-4 h-4 mr-2 mt-0.5 flex-shrink-0" />
                                  <span><strong>¡Importante!</strong> La información se guarda temporalmente en este navegador. Si cierras la pestaña o actualizas la página, <strong>perderás tus notas y fotos</strong>. Por favor, descarga tu PDF antes de salir.</span>
                              </p>
                          </div>
                      </div>
                      <button onClick={downloadPDF} className="hidden md:flex items-center bg-slate-800 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-slate-900 transition-colors"><Download className="w-4 h-4 mr-2" />Probar PDF</button>
                  </div>
              </div>

              {/* MAIN CONTENT */}
              <main className="max-w-6xl mx-auto px-4 relative z-20 pb-24">
                <div className="flex justify-center mb-8">
                  <div className="bg-white p-1.5 rounded-2xl shadow-xl flex flex-wrap md:flex-nowrap gap-2 w-full max-w-2xl">
                    <button onClick={() => setActiveTab('foro')} className={`flex-1 py-3 px-4 rounded-xl font-bold text-sm md:text-base transition-all duration-300 flex items-center justify-center ${activeTab === 'foro' ? 'bg-orange-500 text-white shadow-md transform scale-105' : 'text-slate-500 hover:bg-slate-50'}`}><Users className="w-5 h-5 mr-2" />Foro Nacional</button>
                    <button onClick={() => setActiveTab('mujeres')} className={`flex-1 py-3 px-4 rounded-xl font-bold text-sm md:text-base transition-all duration-300 flex items-center justify-center ${activeTab === 'mujeres' ? 'bg-purple-600 text-white shadow-md transform scale-105' : 'text-slate-500 hover:bg-slate-50'}`}><Award className="w-5 h-5 mr-2" />Encuentro Mujeres</button>
                    <button onClick={() => setActiveTab('contactos')} className={`flex-1 py-3 px-4 rounded-xl font-bold text-sm md:text-base transition-all duration-300 flex items-center justify-center ${activeTab === 'contactos' ? 'bg-blue-600 text-white shadow-md transform scale-105' : 'text-slate-500 hover:bg-slate-50'}`}><Briefcase className="w-5 h-5 mr-2" />Mis Contactos</button>
                  </div>
                </div>

                <div className="transition-opacity duration-300 min-h-[600px]">
                   {activeTab === 'foro' && (
                      <div className="animate-fade-in-up grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                          {mainAgendaData.map((item) => <FlipCard key={item.id} item={item} note={notes[item.id] || ''} onNoteChange={handleNoteChange} status={activityStatus[item.id]} onStatusChange={handleStatusChange} isFlipped={!!flippedState[item.id]} onFlip={() => handleFlip(item.id)} photos={photos[item.id] || []} onPhotoAdd={handlePhotoAdd} onPhotoRemove={handlePhotoRemove} colorTheme="orange" isCurrent={currentEventStatus.current?.id === item.id} />)}
                      </div>
                   )}
                   {activeTab === 'mujeres' && (
                      <div className="animate-fade-in-up">
                          <div className="bg-purple-100 border-l-4 border-purple-500 p-6 rounded-r-xl mb-8 shadow-sm flex flex-col md:flex-row gap-4 items-start justify-between">
                                <div className="flex items-start"><Layout className="w-8 h-8 text-purple-600 mr-4 mt-1" /><div><h3 className="font-bold text-xl text-purple-900">Agenda Paralela</h3><p className="text-purple-700 mb-2">Este encuentro se realiza simultáneamente con el Foro Nacional.</p></div></div>
                                <a href="https://neoseguridadvial.github.io/1rforo/mujeres.html" target="_blank" rel="noopener noreferrer" className="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg transition-colors flex items-center shadow-md"><ExternalLink className="w-5 h-5 mr-2" />Ver Recursos</a>
                          </div>
                          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                              {womenAgendaData.map((item) => <FlipCard key={item.id} item={item} note={notes[item.id] || ''} onNoteChange={handleNoteChange} status={activityStatus[item.id]} onStatusChange={handleStatusChange} isFlipped={!!flippedState[item.id]} onFlip={() => handleFlip(item.id)} photos={photos[item.id] || []} onPhotoAdd={handlePhotoAdd} onPhotoRemove={handlePhotoRemove} colorTheme="purple" isCurrent={currentEventStatus.current?.id === item.id} />)}
                          </div>
                      </div>
                   )}
                   {activeTab === 'contactos' && (
                       <div className="animate-fade-in-up max-w-4xl mx-auto">
                            <div className="bg-white rounded-3xl shadow-xl p-8 border border-slate-100 mb-8">
                                <h3 className="text-xl font-bold text-slate-800 mb-6 flex items-center"><PlusCircle className="w-6 h-6 text-blue-600 mr-2" />Añadir Nuevo Contacto</h3>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                    <input type="text" placeholder="Nombre Completo" className="p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none w-full" value={newContact.name} onChange={(e) => setNewContact({...newContact, name: e.target.value})} />
                                    <input type="text" placeholder="Organización / Rol" className="p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none w-full" value={newContact.org} onChange={(e) => setNewContact({...newContact, org: e.target.value})} />
                                    <input type="text" placeholder="Celular o Email" className="p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none w-full" value={newContact.info} onChange={(e) => setNewContact({...newContact, info: e.target.value})} />
                                </div>
                                <button onClick={handleAddContact} disabled={!newContact.name} className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"><Save className="w-5 h-5 mr-2" />Guardar Contacto</button>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {contacts.length === 0 ? (
                                    <div className="col-span-full text-center py-10 text-slate-400"><Users className="w-16 h-16 mx-auto mb-4 opacity-20" /><p>Aún no has añadido contactos.</p></div>
                                ) : (
                                    contacts.map(contact => (
                                        <div key={contact.id} className="bg-white p-6 rounded-2xl shadow-md border-l-4 border-blue-500 flex justify-between items-start hover:shadow-lg transition-shadow">
                                            <div><h4 className="font-bold text-lg text-slate-800">{contact.name}</h4><div className="flex items-center text-slate-500 text-sm mt-1"><Briefcase className="w-3 h-3 mr-2" />{contact.org || 'Sin organización'}</div><div className="flex items-center text-slate-500 text-sm mt-1"><Phone className="w-3 h-3 mr-2" />{contact.info || 'Sin contacto'}</div></div>
                                            <button onClick={() => handleDeleteContact(contact.id)} className="text-red-300 hover:text-red-500 transition-colors p-2"><Trash2 className="w-5 h-5" /></button>
                                        </div>
                                    ))
                                )}
                            </div>
                       </div>
                   )}
                </div>

                <div className="mt-16 bg-white rounded-3xl shadow-xl p-8 border border-slate-100 relative overflow-hidden">
                    <div className="absolute top-0 left-0 w-2 h-full bg-orange-400"></div>
                    <div className="relative z-10">
                        <h2 className="text-2xl md:text-3xl font-bold text-slate-800 mb-2">¿Qué me queda del evento?</h2>
                        <p className="text-slate-500 mb-6">Tómate un momento para escribir tus aprendizajes más valiosos. Esto se incluirá en tu PDF.</p>
                        <textarea value={finalReflection} onChange={(e) => setFinalReflection(e.target.value)} className="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500 focus:outline-none min-h-[150px] text-slate-700 shadow-inner transition-all hover:bg-white" placeholder="Mis mayores aprendizajes hoy fueron..." />
                    </div>
                    <Heart className="absolute -bottom-6 -right-6 w-40 h-40 text-orange-50 opacity-50 transform rotate-12" />
                </div>
              </main>

              {/* NUEVO BOTÓN VOLVER AL INICIO */}
              <ScrollToTopButton />

              <button onClick={downloadPDF} className="fixed bottom-8 right-8 z-50 bg-slate-900 hover:bg-black text-white p-5 rounded-full shadow-2xl flex items-center transition-all hover:scale-105 hover:rotate-2 active:scale-95 group" title="Generar Memorias PDF">
                  <Download className="w-6 h-6 group-hover:animate-bounce" />
                  <span className="max-w-0 overflow-hidden group-hover:max-w-xs group-hover:ml-3 transition-all duration-500 whitespace-nowrap font-bold text-lg">Descargar Memorias</span>
              </button>
            </div>
          );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
